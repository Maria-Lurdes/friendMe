{"ast":null,"code":"import { FormControl, FormGroup, Validators } from \"@angular/forms\";\nimport { deleteObject, getStorage, ref, uploadBytes } from \"firebase/storage\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/dialog\";\nimport * as i2 from \"../../shared/services/post.service\";\nimport * as i3 from \"../../shared/services/alert.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/button\";\nimport * as i6 from \"@angular/material/icon\";\nimport * as i7 from \"@angular/material/form-field\";\nimport * as i8 from \"@angular/material/input\";\nimport * as i9 from \"@angular/material/select\";\nimport * as i10 from \"@angular/material/core\";\nimport * as i11 from \"@angular/forms\";\n\nfunction CreateEditPostModalComponent_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \"Edit\");\n    i0.ɵɵelementContainerEnd();\n  }\n}\n\nfunction CreateEditPostModalComponent_ng_template_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Create\");\n  }\n}\n\nfunction CreateEditPostModalComponent_mat_error_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Please fill the field correctly\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CreateEditPostModalComponent_mat_error_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Please fill the field correctly\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CreateEditPostModalComponent_mat_error_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Please fill the field correctly\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CreateEditPostModalComponent_mat_error_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Please fill the field correctly\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CreateEditPostModalComponent_mat_error_40_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Please fill the field correctly\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CreateEditPostModalComponent_mat_error_49_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-error\");\n    i0.ɵɵtext(1, \"Please fill the field correctly\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction CreateEditPostModalComponent_p_55_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 26);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r9.avatarName);\n  }\n}\n\nfunction CreateEditPostModalComponent_ng_container_57_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtext(1, \"Update\");\n    i0.ɵɵelementContainerEnd();\n  }\n}\n\nfunction CreateEditPostModalComponent_ng_template_58_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Create\");\n  }\n}\n\nexport let CreateEditPostModalComponent = /*#__PURE__*/(() => {\n  class CreateEditPostModalComponent {\n    constructor(dialogRef, postService, alert) {\n      this.dialogRef = dialogRef;\n      this.postService = postService;\n      this.alert = alert;\n      this.submitted = false;\n      this.fireStorage = getStorage();\n    }\n\n    ngOnInit() {\n      this.petPost = new FormGroup({\n        name: new FormControl(this.postToEdit ? this.postToEdit.name : null, [Validators.required]),\n        description: new FormControl(this.postToEdit ? this.postToEdit.description : null, [Validators.required]),\n        age: new FormControl(this.postToEdit ? this.postToEdit.age : null, [Validators.required]),\n        sex: new FormControl(this.postToEdit ? this.postToEdit.sex : null, [Validators.required]),\n        weight: new FormControl(this.postToEdit ? this.postToEdit.weight : null, [Validators.required]),\n        type: new FormControl(this.postToEdit ? this.postToEdit.type : null, [Validators.required])\n      });\n    }\n\n    closeModal() {\n      this.dialogRef.close();\n    }\n\n    submit() {\n      this.submitted = true;\n      const post = {\n        name: this.petPost.value.name,\n        description: this.petPost.value.description,\n        age: this.petPost.value.age,\n        sex: this.petPost.value.sex,\n        weight: this.petPost.value.weight,\n        type: this.petPost.value.type\n      };\n\n      if (this.postToEdit) {\n        this.postService.updatePost(this.postToEdit.id, post).subscribe(() => {\n          if (this.avatarName) {\n            this.updatePostImage();\n          } else {\n            this.completeRequest();\n          }\n        });\n      } else {\n        this.postService.createPost(post).subscribe(data => {\n          this.uploadImageToStorage(data.id);\n        }, () => this.submitted = false);\n      }\n    }\n\n    uploadImageToStorage(id) {\n      const file = this.petAvatar.item(0);\n      let url = ref(this.fireStorage, `pets-avatars/${id}`);\n      const metadata = {\n        contentType: \"image/jpeg\"\n      };\n      uploadBytes(url, file, metadata).then(() => {\n        this.completeRequest();\n      }, () => this.submitted = false);\n    }\n\n    completeRequest() {\n      this.submitted = false;\n      this.petPost.reset();\n      this.closeModal();\n      this.postService.getAll();\n      this.alert.success(\"Changes are successfully saved!\");\n    }\n\n    updatePostImage() {\n      const imageRef = ref(this.fireStorage, `pets-avatars/${this.postToEdit.id}`);\n      deleteObject(imageRef).then(() => {\n        this.uploadImageToStorage(this.postToEdit.id);\n      }).catch(() => {\n        this.alert.danger(\"Smth went wrong, try again later\");\n      });\n    }\n\n    setFile(e) {\n      if (e.target.files[0].size > 50000000) {\n        this.alert.warning(\"Your file is bigger than 500ko. Please, choose another one.\");\n      } else {\n        this.petAvatar = e.target.files;\n        this.avatarName = e.target.files[0].name;\n      }\n    }\n\n    buttonIsDisabled() {\n      const imageIsNotValid = !this.postToEdit && !this.avatarName;\n      return this.petPost.invalid || this.submitted || imageIsNotValid;\n    }\n\n  }\n\n  CreateEditPostModalComponent.ɵfac = function CreateEditPostModalComponent_Factory(t) {\n    return new (t || CreateEditPostModalComponent)(i0.ɵɵdirectiveInject(i1.MatDialogRef), i0.ɵɵdirectiveInject(i2.PostService), i0.ɵɵdirectiveInject(i3.AlertService));\n  };\n\n  CreateEditPostModalComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CreateEditPostModalComponent,\n    selectors: [[\"app-create-edit-post-modal\"]],\n    decls: 61,\n    vars: 13,\n    consts: [[\"mat-dialog-title\", \"\", 1, \"title-wrapper\"], [4, \"ngIf\", \"ngIfElse\"], [\"create\", \"\"], [\"matSuffix\", \"\", 3, \"click\"], [1, \"mat-typography\"], [1, \"form-wrapper\", 3, \"formGroup\"], [\"appearance\", \"outline\"], [\"formControlName\", \"name\", \"matInput\", \"\", \"type\", \"text\"], [4, \"ngIf\"], [\"formControlName\", \"description\", \"matInput\", \"\"], [\"formControlName\", \"age\", \"matInput\", \"\", \"max\", \"100\", \"min\", \"0\", \"type\", \"number\"], [\"formControlName\", \"weight\", \"matInput\", \"\", \"min\", \"0\", \"type\", \"number\"], [\"appearance\", \"fill\"], [\"formControlName\", \"type\"], [\"value\", \"cat\"], [\"value\", \"dog\"], [\"value\", \"horse\"], [\"formControlName\", \"sex\"], [\"value\", \"male\"], [\"value\", \"female\"], [1, \"custom-file-upload\"], [\"accept\", \"image/png, image/jpeg\", \"type\", \"file\", 3, \"change\"], [\"matSuffix\", \"\"], [\"class\", \"file-name\", 4, \"ngIf\"], [\"color\", \"primary\", \"mat-raised-button\", \"\", 1, \"create\", 3, \"disabled\", \"click\"], [\"createPet\", \"\"], [1, \"file-name\"]],\n    template: function CreateEditPostModalComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"h2\", 0)(1, \"span\");\n        i0.ɵɵtemplate(2, CreateEditPostModalComponent_ng_container_2_Template, 2, 0, \"ng-container\", 1);\n        i0.ɵɵtemplate(3, CreateEditPostModalComponent_ng_template_3_Template, 1, 0, \"ng-template\", null, 2, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵtext(5, \" Post \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"mat-icon\", 3);\n        i0.ɵɵlistener(\"click\", function CreateEditPostModalComponent_Template_mat_icon_click_6_listener() {\n          return ctx.closeModal();\n        });\n        i0.ɵɵtext(7, \"close\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(8, \"mat-dialog-content\", 4)(9, \"form\", 5)(10, \"mat-form-field\", 6)(11, \"mat-label\");\n        i0.ɵɵtext(12, \"Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(13, \"input\", 7);\n        i0.ɵɵtemplate(14, CreateEditPostModalComponent_mat_error_14_Template, 2, 0, \"mat-error\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"mat-form-field\", 6)(16, \"mat-label\");\n        i0.ɵɵtext(17, \"Description\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(18, \"textarea\", 9);\n        i0.ɵɵtemplate(19, CreateEditPostModalComponent_mat_error_19_Template, 2, 0, \"mat-error\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(20, \"mat-form-field\", 6)(21, \"mat-label\");\n        i0.ɵɵtext(22, \"Age\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(23, \"input\", 10);\n        i0.ɵɵtemplate(24, CreateEditPostModalComponent_mat_error_24_Template, 2, 0, \"mat-error\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(25, \"mat-form-field\", 6)(26, \"mat-label\");\n        i0.ɵɵtext(27, \"Weight\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(28, \"input\", 11);\n        i0.ɵɵtemplate(29, CreateEditPostModalComponent_mat_error_29_Template, 2, 0, \"mat-error\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(30, \"mat-form-field\", 12)(31, \"mat-label\");\n        i0.ɵɵtext(32, \"Type\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(33, \"mat-select\", 13)(34, \"mat-option\", 14);\n        i0.ɵɵtext(35, \"Cat\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(36, \"mat-option\", 15);\n        i0.ɵɵtext(37, \"Dog\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(38, \"mat-option\", 16);\n        i0.ɵɵtext(39, \"Horse\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(40, CreateEditPostModalComponent_mat_error_40_Template, 2, 0, \"mat-error\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(41, \"mat-form-field\", 12)(42, \"mat-label\");\n        i0.ɵɵtext(43, \"Sex\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(44, \"mat-select\", 17)(45, \"mat-option\", 18);\n        i0.ɵɵtext(46, \"Male\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(47, \"mat-option\", 19);\n        i0.ɵɵtext(48, \"Female\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵtemplate(49, CreateEditPostModalComponent_mat_error_49_Template, 2, 0, \"mat-error\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(50, \"label\", 20)(51, \"input\", 21);\n        i0.ɵɵlistener(\"change\", function CreateEditPostModalComponent_Template_input_change_51_listener($event) {\n          return ctx.setFile($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(52, \"mat-icon\", 22);\n        i0.ɵɵtext(53, \"folder\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(54, \" Upload image for pet \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(55, CreateEditPostModalComponent_p_55_Template, 2, 1, \"p\", 23);\n        i0.ɵɵelementStart(56, \"button\", 24);\n        i0.ɵɵlistener(\"click\", function CreateEditPostModalComponent_Template_button_click_56_listener() {\n          return ctx.submit();\n        });\n        i0.ɵɵtemplate(57, CreateEditPostModalComponent_ng_container_57_Template, 2, 0, \"ng-container\", 1);\n        i0.ɵɵtemplate(58, CreateEditPostModalComponent_ng_template_58_Template, 1, 0, \"ng-template\", null, 25, i0.ɵɵtemplateRefExtractor);\n        i0.ɵɵtext(60, \" Pet \");\n        i0.ɵɵelementEnd()()();\n      }\n\n      if (rf & 2) {\n        const _r1 = i0.ɵɵreference(4);\n\n        const _r11 = i0.ɵɵreference(59);\n\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.postToEdit)(\"ngIfElse\", _r1);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"formGroup\", ctx.petPost);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngIf\", ctx.petPost.get(\"name\").errors);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngIf\", ctx.petPost.get(\"description\").errors);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngIf\", ctx.petPost.get(\"age\").errors);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngIf\", ctx.petPost.get(\"weight\").errors);\n        i0.ɵɵadvance(11);\n        i0.ɵɵproperty(\"ngIf\", ctx.petPost.get(\"type\").errors);\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"ngIf\", ctx.petPost.get(\"sex\").errors);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngIf\", ctx.avatarName);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"disabled\", ctx.buttonIsDisabled());\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.postToEdit)(\"ngIfElse\", _r11);\n      }\n    },\n    dependencies: [i4.NgIf, i5.MatButton, i6.MatIcon, i1.MatDialogTitle, i1.MatDialogContent, i7.MatError, i7.MatFormField, i7.MatLabel, i7.MatSuffix, i8.MatInput, i9.MatSelect, i10.MatOption, i11.ɵNgNoValidate, i11.DefaultValueAccessor, i11.NumberValueAccessor, i11.NgControlStatus, i11.NgControlStatusGroup, i11.MinValidator, i11.MaxValidator, i11.FormGroupDirective, i11.FormControlName],\n    styles: [\".title-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.title-wrapper[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{cursor:pointer}h2[_ngcontent-%COMP%]{font-size:26px;color:#03063a}.form-wrapper[_ngcontent-%COMP%]{width:400px;display:flex;flex-direction:column}.form-wrapper[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{display:none}.form-wrapper[_ngcontent-%COMP%]   .custom-file-upload[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;flex-wrap:wrap;cursor:pointer;border:1px solid #e0e0e0;line-height:36px;align-items:center;border-radius:4px}.form-wrapper[_ngcontent-%COMP%]   .custom-file-upload[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:5px}.form-wrapper[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{text-align:center}.form-wrapper[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#fff;margin-top:30px;background:linear-gradient(180deg,#64adef 0%,#3198f4 100%);padding:8px 0;cursor:url(small-paw.png),url(small-paw.png),auto}.form-wrapper[_ngcontent-%COMP%]   button[disabled][_ngcontent-%COMP%]{background:gray}@media (max-width: 768px){.form-wrapper[_ngcontent-%COMP%]{width:300px}}@media (max-width: 475px){.form-wrapper[_ngcontent-%COMP%]{width:245px}}\"]\n  });\n  return CreateEditPostModalComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}